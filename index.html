<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Mitchells Mileage + AFR VAT Calculator</title>

<style>
  body{
    margin:0;
    font-family:Arial, sans-serif;
    background:#111;
    color:#fff;
  }

  .wrap{
    max-width:1000px;
    margin:auto;
    padding:25px;
  }

  h1{
    font-size:22px;
    margin-bottom:5px;
  }

  .sub{
    color:#bbb;
    font-size:14px;
    margin-bottom:20px;
    line-height:1.4;
  }

  .card{
    background:#1b1b1b;
    padding:18px;
    border-radius:10px;
    margin-bottom:15px;
    box-shadow:0 8px 25px rgba(0,0,0,.5);
  }

  label{
    display:block;
    margin:10px 0 6px;
    font-size:13px;
    color:#bbb;
  }

  input, select{
    width:100%;
    padding:10px;
    border-radius:8px;
    border:1px solid #333;
    background:#0f0f0f;
    color:white;
  }

  button{
    margin-top:15px;
    padding:10px 16px;
    border:none;
    border-radius:8px;
    cursor:pointer;
    background:#2aa876;
    color:white;
    font-size:14px;
  }

  button.secondary{
    background:#333;
  }

  table{
    width:100%;
    border-collapse:collapse;
    margin-top:10px;
  }

  th, td{
    border-bottom:1px solid #333;
    padding:10px;
    font-size:13px;
    text-align:left;
  }

  th{
    color:#aaa;
  }

  .pill{
    background:#141414;
    padding:12px;
    border-radius:10px;
    border:1px solid #333;
    margin-top:10px;
  }

  .pill .k{
    color:#aaa;
    font-size:12px;
  }

  .pill .v{
    font-size:18px;
    margin-top:6px;
  }

  .note{
    color:#888;
    font-size:12px;
    margin-top:8px;
    line-height:1.4;
  }
</style>
</head>

<body>
<div class="wrap">

<h1>Mitchells Mileage + AFR VAT Calculator</h1>
<p class="sub">
Standard mileage allowance plus HMRC Advisory Fuel Rates (AFR) for VAT fuel calculations.<br>
AFR rates must be updated quarterly from GOV.UK.
</p>

<div class="card">
  <h2 style="margin:0;font-size:16px;">Add Trip</h2>

  <label>Date</label>
  <input id="date" type="date">

  <label>Staff Name</label>
  <input id="staff" placeholder="e.g. James Biggs">

  <label>Miles Travelled</label>
  <input id="miles" type="number" step="0.1" placeholder="e.g. 45.5">

  <label>Miles already claimed this tax year</label>
  <input id="already" type="number" step="1" placeholder="e.g. 3200">

  <hr style="border:0;border-top:1px solid #333;margin:15px 0;">

  <h3 style="margin:0;font-size:14px;color:#ccc;">
    Advisory Fuel Rate (Company Car Fuel)
  </h3>

  <label>Fuel Type</label>
  <select id="fuel">
    <option value="petrol">Petrol</option>
    <option value="diesel">Diesel</option>
    <option value="lpg">LPG</option>
    <option value="electric_home">Electric (Home)</option>
    <option value="electric_public">Electric (Public)</option>
  </select>

  <label>Engine Size Category</label>
  <select id="engine">
    <option value="small">Small (≤1400cc petrol / ≤1600cc diesel)</option>
    <option value="medium">Medium (1401–2000cc)</option>
    <option value="large">Large (>2000cc)</option>
  </select>

  <button onclick="addTrip()">Add Trip</button>
</div>

<div class="card">
  <h2 style="margin:0;font-size:16px;">Totals</h2>

  <div class="pill">
    <div class="k">Total Miles</div>
    <div class="v" id="totalMiles">0</div>
  </div>

  <div class="pill">
    <div class="k">Mileage Claim (45p/25p)</div>
    <div class="v" id="totalClaim">£0.00</div>
  </div>

  <div class="pill">
    <div class="k">AFR Fuel Cost</div>
    <div class="v" id="totalFuel">£0.00</div>
  </div>

  <div class="pill">
    <div class="k">VAT Element (Fuel ÷ 6)</div>
    <div class="v" id="totalVAT">£0.00</div>
  </div>

  <button class="secondary" onclick="exportCSV()">Export CSV</button>
</div>

<div class="card">
  <h2 style="margin:0;font-size:16px;">Trips</h2>

  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Staff</th>
        <th>Miles</th>
        <th>Mileage £</th>
        <th>Fuel £</th>
        <th>VAT £</th>
      </tr>
    </thead>
    <tbody id="rows">
      <tr><td colspan="6" style="color:#777;">No trips yet.</td></tr>
    </tbody>
  </table>

  <p class="note">
    AFR rates are from HMRC Advisory Fuel Rates guidance:
    https://www.gov.uk/guidance/advisory-fuel-rates
  </p>
</div>

</div>

<script>
/* -----------------------------
   HMRC Advisory Fuel Rates Table
   Update quarterly
--------------------------------*/
const AFR = {
  petrol:   { small:12, medium:14, large:22 },
  diesel:   { small:12, medium:13, large:18 },
  lpg:      { small:11, medium:13, large:21 },
  electric_home:   { small:7, medium:7, large:7 },
  electric_public: { small:14, medium:14, large:14 }
};

const trips = [];

function gbp(n){
  return new Intl.NumberFormat("en-GB", {
    style:"currency",
    currency:"GBP"
  }).format(n);
}

/* Mileage Allowance 45p/25p */
function mileageClaim(miles, already){
  let threshold = 10000;

  let remaining45 = Math.max(0, threshold - already);

  let at45 = Math.min(miles, remaining45);
  let at25 = miles - at45;

  return (at45 * 0.45) + (at25 * 0.25);
}

/* AFR Fuel + VAT */
function afrFuel(miles, fuelType, engine){
  let ratePence = AFR[fuelType][engine];
  let fuelCost = (ratePence/100) * miles;
  let vat = fuelCost / 6;
  return { fuelCost, vat };
}

function addTrip(){
  let date = document.getElementById("date").value;
  let staff = document.getElementById("staff").value;
  let miles = parseFloat(document.getElementById("miles").value);
  let already = parseFloat(document.getElementById("already").value) || 0;

  let fuel = document.getElementById("fuel").value;
  let engine = document.getElementById("engine").value;

  if(!miles || miles<=0){
    alert("Enter valid miles.");
    return;
  }

  let claim = mileageClaim(miles, already);
  let fuelCalc = afrFuel(miles, fuel, engine);

  trips.push({
    date, staff, miles,
    claim,
    fuel: fuelCalc.fuelCost,
    vat: fuelCalc.vat
  });

  render();
}

function render(){
  let tbody = document.getElementById("rows");
  tbody.innerHTML = "";

  if(trips.length===0){
    tbody.innerHTML = `<tr><td colspan="6" style="color:#777;">No trips yet.</td></tr>`;
    return;
  }

  let totalMiles=0, totalClaim=0, totalFuel=0, totalVAT=0;

  trips.forEach(t=>{
    totalMiles += t.miles;
    totalClaim += t.claim;
    totalFuel += t.fuel;
    totalVAT += t.vat;

    tbody.innerHTML += `
      <tr>
        <td>${t.date}</td>
        <td>${t.staff}</td>
        <td>${t.miles.toFixed(1)}</td>
        <td>${gbp(t.claim)}</td>
        <td>${gbp(t.fuel)}</td>
        <td>${gbp(t.vat)}</td>
      </tr>
    `;
  });

  document.getElementById("totalMiles").textContent = totalMiles.toFixed(1);
  document.getElementById("totalClaim").textContent = gbp(totalClaim);
  document.getElementById("totalFuel").textContent = gbp(totalFuel);
  document.getElementById("totalVAT").textContent = gbp(totalVAT);
}

function exportCSV(){
  let csv = "Date,Staff,Miles,MileageClaim,FuelCost,VAT\n";
  trips.forEach(t=>{
    csv += `${t.date},${t.staff},${t.miles},${t.claim.toFixed(2)},${t.fuel.toFixed(2)},${t.vat.toFixed(2)}\n`;
  });

  let blob = new Blob([csv], {type:"text/csv"});
  let link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "mileage_log.csv";
  link.click();
}
</script>

</body>
</html>
