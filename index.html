<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Mitchells Mileage Claim Tool</title>

<style>
  :root{
    --bg:#f4f6f9;
    --card:#ffffff;
    --border:#d9dee7;
    --text:#1c1f26;
    --muted:#5f6775;

    --accent:#2aa876;
    --accent2:#1f8d63;
    --danger:#d94b4b;
  }

  *{
    box-sizing:border-box;
  }

  body{
    margin:0;
    background:var(--bg);
    color:var(--text);
    font-family:"Segoe UI", Arial, sans-serif;
  }

  .wrap{
    max-width:1150px;
    margin:auto;
    padding:32px 18px 70px;
  }

  header{
    margin-bottom:20px;
  }

  h1{
    margin:0;
    font-size:26px;
    font-weight:650;
  }

  .sub{
    margin-top:6px;
    color:var(--muted);
    font-size:14px;
    line-height:1.5;
  }

  /* Dashboard Layout */
  .grid{
    display:grid;
    grid-template-columns:1fr;
    gap:18px;
  }

  @media(min-width:900px){
    .grid{
      grid-template-columns:1.25fr 0.75fr;
      align-items:start;
    }
  }

  /* Cards */
  .card{
    background:var(--card);
    border:1px solid var(--border);
    border-radius:16px;
    padding:18px;
    box-shadow:0 6px 18px rgba(0,0,0,.08);
    display:block;
  }

  .card h2{
    margin:0 0 12px;
    font-size:16px;
    font-weight:650;
  }

  /* Form Rows */
  .row{
    display:grid;
    grid-template-columns:1fr;
    gap:12px;
    margin-top:12px;
  }

  @media(min-width:650px){
    .row{
      grid-template-columns:1fr 1fr;
    }
  }

  label{
    display:block;
    font-size:12px;
    color:var(--muted);
    margin-bottom:6px;
    font-weight:600;
  }

  input, select{
    width:100%;
    padding:11px 12px;
    border-radius:10px;
    border:1px solid var(--border);
    background:#fbfcfe;
    font-size:14px;
    outline:none;
    transition:.15s;
  }

  input:focus, select:focus{
    border-color:var(--accent);
    box-shadow:0 0 0 2px rgba(42,168,118,.25);
  }

  hr{
    border:0;
    border-top:1px solid var(--border);
    margin:18px 0;
  }

  /* Buttons */
  .actions{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    margin-top:16px;
  }

  button{
    border:none;
    border-radius:10px;
    padding:11px 14px;
    cursor:pointer;
    font-size:14px;
    font-weight:650;
    transition:.15s;
  }

  button.primary{
    background:var(--accent);
    color:white;
  }

  button.primary:hover{
    background:var(--accent2);
  }

  button.secondary{
    background:#eef1f6;
    border:1px solid var(--border);
    color:#222;
  }

  button.secondary:hover{
    background:#e2e7ef;
  }

  button.danger{
    background:var(--danger);
    color:white;
    padding:7px 10px;
    font-size:12px;
  }

  /* Totals */
  .pill{
    padding:14px;
    border-radius:14px;
    border:1px solid var(--border);
    background:#f9fafc;
    margin-top:12px;
  }

  .pill .k{
    font-size:12px;
    color:var(--muted);
  }

  .pill .v{
    margin-top:6px;
    font-size:20px;
    font-weight:700;
  }

  /* Trips Table */
  table{
    width:100%;
    border-collapse:collapse;
    margin-top:10px;
    border-radius:12px;
    overflow:hidden;
  }

  th, td{
    padding:12px 10px;
    font-size:13px;
    border-bottom:1px solid var(--border);
    text-align:left;
  }

  th{
    color:var(--muted);
    font-weight:650;
    background:#f1f3f7;
  }

  tr:hover td{
    background:#f8fafc;
  }

  /* Print Mode */
  @media print{
    body{
      background:white;
    }
    .grid, button, input, select, hr{
      display:none !important;
    }
    .card{
      box-shadow:none;
    }
  }
</style>
</head>

<body>
<div class="wrap">

<header>
  <h1>Mitchells Mileage Claim Tool</h1>
  <p class="sub">
    Mileage allowance (45p/25p) plus HMRC Advisory Fuel Rates for VAT fuel element (fuel ÷ 6).
  </p>
</header>

<div class="grid">

  <!-- LEFT: FORM -->
  <div class="card">
    <h2>Add Trip</h2>

    <div class="row">
      <div>
        <label>Date</label>
        <input id="date" type="date">
      </div>
      <div>
        <label>Staff Name</label>
        <input id="staff">
      </div>
    </div>

    <div class="row">
      <div>
        <label>Client Code</label>
        <input id="clientCode">
      </div>
      <div>
        <label>Client Name</label>
        <input id="clientName">
      </div>
    </div>

    <div class="row">
      <div style="grid-column:1 / -1;">
        <label>Trip Reason</label>
        <input id="reason">
      </div>
    </div>

    <div class="row">
      <div>
        <label>Miles Travelled</label>
        <input id="miles" type="number" step="0.1">
      </div>
      <div>
        <label>Miles already claimed this tax year</label>
        <input id="already" type="number" value="0">
      </div>
    </div>

    <hr>

    <h2 style="font-size:14px;color:var(--muted);">
      Advisory Fuel Rate (Company Car)
    </h2>

    <div class="row">
      <div>
        <label>Engine Size Category</label>
        <select id="engine">
          <option value="small">Small (≤1400cc petrol / ≤1600cc diesel)</option>
          <option value="medium">Medium (1401–2000cc)</option>
          <option value="large">Large (>2000cc)</option>
        </select>
      </div>

      <div>
        <label>Fuel Type</label>
        <select id="fuel">
          <option value="petrol">Petrol</option>
          <option value="diesel">Diesel</option>
          <option value="lpg">LPG</option>
          <option value="electric_home">Electric (Home)</option>
          <option value="electric_public">Electric (Public)</option>
        </select>
      </div>
    </div>

    <div class="actions">
      <button class="primary" onclick="addTrip()">Add Trip</button>
      <button class="secondary" onclick="resetForm()">Reset Form</button>
    </div>
  </div>

  <!-- RIGHT: TOTALS -->
  <div class="card">
    <h2>Totals</h2>

    <div class="pill">
      <div class="k">Total Miles</div>
      <div class="v" id="totalMiles">0.0</div>
    </div>

    <div class="pill">
      <div class="k">Mileage Claim</div>
      <div class="v" id="totalClaim">£0.00</div>
    </div>

    <div class="pill">
      <div class="k">AFR Fuel Cost</div>
      <div class="v" id="totalFuel">£0.00</div>
    </div>

    <div class="pill">
      <div class="k">VAT Element</div>
      <div class="v" id="totalVAT">£0.00</div>
    </div>

    <div class="actions">
      <button class="secondary" onclick="exportCSV()">Export CSV</button>
      <button class="secondary" onclick="window.print()">Print Report</button>
    </div>
  </div>

</div>

<!-- TRIPS TABLE -->
<div class="card" style="margin-top:18px;">
  <h2>Trips Logged</h2>

  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Staff</th>
        <th>Client</th>
        <th>Reason</th>
        <th>Miles</th>
        <th>Mileage £</th>
        <th>Fuel £</th>
        <th>VAT £</th>
        <th></th>
      </tr>
    </thead>
    <tbody id="rows">
      <tr><td colspan="9" style="color:#777;">No trips yet.</td></tr>
    </tbody>
  </table>
</div>

</div>

<script>
const AFR = {
  petrol: { small:12, medium:14, large:22 },
  diesel: { small:12, medium:13, large:18 },
  lpg:    { small:11, medium:13, large:21 },
  electric_home:   { small:7, medium:7, large:7 },
  electric_public: { small:14, medium:14, large:14 }
};

const trips = [];

function gbp(n){
  return new Intl.NumberFormat("en-GB", {
    style:"currency",
    currency:"GBP"
  }).format(n);
}

function mileageClaim(miles, already){
  let threshold = 10000;
  let remaining45 = Math.max(0, threshold - already);
  let at45 = Math.min(miles, remaining45);
  let at25 = miles - at45;
  return (at45 * 0.45) + (at25 * 0.25);
}

function afrCalc(miles, fuel, engine){
  let ratePence = AFR[fuel][engine];
  let fuelCost = (ratePence/100) * miles;
  let vat = fuelCost / 6;
  return { fuelCost, vat };
}

function addTrip(){
  let miles = parseFloat(milesInput.value);
  let already = parseFloat(alreadyInput.value) || 0;

  if(!miles || miles<=0){
    alert("Please enter valid miles.");
    return;
  }

  let claim = mileageClaim(miles, already);
  let afr = afrCalc(miles, fuelSelect.value, engineSelect.value);

  trips.push({
    date: dateInput.value,
    staff: staffInput.value,
    client: clientCodeInput.value + " – " + clientNameInput.value,
    reason: reasonInput.value,
    miles,
    claim,
    fuel: afr.fuelCost,
    vat: afr.vat
  });

  render();
}

function resetForm(){
  dateInput.value="";
  staffInput.value="";
  clientCodeInput.value="";
  clientNameInput.value="";
  reasonInput.value="";
  milesInput.value="";
  alreadyInput.value="0";
  engineSelect.value="small";
  fuelSelect.value="petrol";
}

function removeTrip(i){
  trips.splice(i,1);
  render();
}

function render(){
  rows.innerHTML="";
  let totalMiles=0,totalClaim=0,totalFuel=0,totalVAT=0;

  if(trips.length===0){
    rows.innerHTML=`<tr><td colspan="9" style="color:#777;">No trips yet.</td></tr>`;
  }

  trips.forEach((t,i)=>{
    totalMiles+=t.miles;
    totalClaim+=t.claim;
    totalFuel+=t.fuel;
    totalVAT+=t.vat;

    rows.innerHTML+=`
      <tr>
        <td>${t.date}</td>
        <td>${t.staff}</td>
        <td>${t.client}</td>
        <td>${t.reason}</td>
        <td>${t.miles.toFixed(1)}</td>
        <td>${gbp(t.claim)}</td>
        <td>${gbp(t.fuel)}</td>
        <td>${gbp(t.vat)}</td>
        <td><button class="danger" onclick="removeTrip(${i})">Remove</button></td>
      </tr>`;
  });

  totalMilesEl.textContent=totalMiles.toFixed(1);
  totalClaimEl.textContent=gbp(totalClaim);
  totalFuelEl.textContent=gbp(totalFuel);
  totalVATEl.textContent=gbp(totalVAT);
}

function exportCSV(){
  let csv="Date,Staff,Client,Reason,Miles,MileageClaim,FuelCost,VAT\n";
  trips.forEach(t=>{
    csv+=`${t.date},${t.staff},${t.client},${t.reason},${t.miles.toFixed(1)},${t.claim.toFixed(2)},${t.fuel.toFixed(2)},${t.vat.toFixed(2)}\n`;
  });

  let blob=new Blob([csv],{type:"text/csv"});
  let link=document.createElement("a");
  link.href=URL.createObjectURL(blob);
  link.download="mileage_log.csv";
  link.click();
}

/* DOM refs */
const dateInput=document.getElementById("date");
const staffInput=document.getElementById("staff");
const clientCodeInput=document.getElementById("clientCode");
const clientNameInput=document.getElementById("clientName");
const reasonInput=document.getElementById("reason");
const milesInput=document.getElementById("miles");
const alreadyInput=document.getElementById("already");
const fuelSelect=document.getElementById("fuel");
const engineSelect=document.getElementById("engine");

const rows=document.getElementById("rows");
const totalMilesEl=document.getElementById("totalMiles");
const totalClaimEl=document.getElementById("totalClaim");
const totalFuelEl=document.getElementById("totalFuel");
const totalVATEl=document.getElementById("totalVAT");
</script>

</body>
</html>
