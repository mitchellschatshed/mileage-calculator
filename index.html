<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Mitchells Mileage Calculator</title>

<style>
  :root{
    --bg:#0f1115;
    --card:#171a21;
    --border:#262a33;
    --text:#f5f6f7;
    --muted:#a7acb8;
    --accent:#2aa876;
    --accent2:#1f8d63;
  }

  body{
    margin:0;
    background:var(--bg);
    color:var(--text);
    font-family: "Segoe UI", Arial, sans-serif;
  }

  .wrap{
    max-width:1100px;
    margin:auto;
    padding:30px 18px 70px;
  }

  header{
    margin-bottom:20px;
  }

  h1{
    margin:0;
    font-size:24px;
    font-weight:600;
  }

  .sub{
    margin-top:6px;
    color:var(--muted);
    font-size:14px;
    line-height:1.4;
  }

  /* Dashboard layout */
  .grid{
    display:grid;
    grid-template-columns:1fr;
    gap:18px;
  }

  @media(min-width:900px){
    .grid{
      grid-template-columns:1.2fr 0.8fr;
      align-items:start;
    }
  }

  /* Card styling */
  .card{
    background:var(--card);
    border:1px solid var(--border);
    border-radius:16px;
    padding:18px;
    box-shadow:0 10px 30px rgba(0,0,0,.35);
  }

  .card h2{
    margin:0 0 12px;
    font-size:16px;
    font-weight:600;
  }

  /* Form layout */
  .row{
    display:grid;
    grid-template-columns:1fr;
    gap:12px;
  }

  @media(min-width:650px){
    .row{
      grid-template-columns:1fr 1fr;
    }
  }

  label{
    display:block;
    font-size:12px;
    color:var(--muted);
    margin-bottom:6px;
  }

  input, select{
    width:100%;
    padding:11px 12px;
    border-radius:10px;
    border:1px solid var(--border);
    background:#0c0e12;
    color:var(--text);
    font-size:14px;
    outline:none;
    transition:.15s;
  }

  input:focus, select:focus{
    border-color:var(--accent);
    box-shadow:0 0 0 2px rgba(42,168,118,.25);
  }

  hr{
    border:0;
    border-top:1px solid var(--border);
    margin:18px 0;
  }

  /* Buttons */
  .actions{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    margin-top:12px;
  }

  button{
    border:none;
    border-radius:10px;
    padding:11px 14px;
    cursor:pointer;
    font-size:14px;
    font-weight:600;
    transition:.15s;
  }

  button.primary{
    background:var(--accent);
    color:white;
  }

  button.primary:hover{
    background:var(--accent2);
  }

  button.secondary{
    background:#232733;
    color:white;
    border:1px solid var(--border);
  }

  button.secondary:hover{
    background:#2c3140;
  }

  /* Totals pills */
  .pill{
    padding:14px;
    border-radius:14px;
    border:1px solid var(--border);
    background:#11141b;
    margin-top:12px;
  }

  .pill .k{
    font-size:12px;
    color:var(--muted);
  }

  .pill .v{
    margin-top:6px;
    font-size:20px;
    font-weight:600;
  }

  /* Table */
  table{
    width:100%;
    border-collapse:collapse;
    margin-top:10px;
    overflow:hidden;
    border-radius:12px;
  }

  th, td{
    padding:12px 10px;
    font-size:13px;
    border-bottom:1px solid var(--border);
    text-align:left;
  }

  th{
    color:var(--muted);
    font-weight:600;
    background:#10131a;
  }

  tr:hover td{
    background:rgba(255,255,255,0.03);
  }

  .note{
    font-size:12px;
    color:var(--muted);
    margin-top:10px;
    line-height:1.4;
  }
</style>
</head>

<body>
<div class="wrap">

<header>
  <h1>Mitchells Mileage & VAT Fuel Calculator</h1>
  <p class="sub">
    Standard mileage allowance (45p/25p) plus HMRC Advisory Fuel Rates (AFR).  
    VAT element is calculated as fuel cost ÷ 6.
  </p>
</header>

<div class="grid">

  <!-- Add Trip -->
  <div class="card">
    <h2>Add Trip</h2>

    <div class="row">
      <div>
        <label>Date</label>
        <input id="date" type="date">
      </div>
      <div>
        <label>Staff Name</label>
        <input id="staff" placeholder="e.g. James Biggs">
      </div>
    </div>

    <div class="row" style="margin-top:12px;">
      <div>
        <label>Client Code</label>
        <input id="clientCode" placeholder="e.g. A00205">
      </div>
      <div>
        <label>Client Name</label>
        <input id="clientName" placeholder="e.g. ABC Limited">
      </div>
    </div>

    <label style="margin-top:12px;">Trip Reason</label>
    <input id="reason" placeholder="e.g. Client meeting, records pickup">

    <div class="row" style="margin-top:12px;">
      <div>
        <label>Miles Travelled</label>
        <input id="miles" type="number" step="0.1">
      </div>
      <div>
        <label>Miles already claimed this tax year</label>
        <input id="already" type="number" value="0">
      </div>
    </div>

    <hr>

    <h2 style="font-size:14px;color:var(--muted);margin-bottom:8px;">
      Advisory Fuel Rate
    </h2>

    <div class="row">
      <div>
        <label>Fuel Type</label>
        <select id="fuel">
          <option value="petrol">Petrol</option>
          <option value="diesel">Diesel</option>
          <option value="lpg">LPG</option>
          <option value="electric_home">Electric (Home)</option>
          <option value="electric_public">Electric (Public)</option>
        </select>
      </div>

      <div>
        <label>Engine Size</label>
        <select id="engine">
          <option value="small">Small</option>
          <option value="medium">Medium</option>
          <option value="large">Large</option>
        </select>
      </div>
    </div>

    <div class="actions">
      <button class="primary" onclick="addTrip()">Add Trip</button>
    </div>
  </div>

  <!-- Totals -->
  <div class="card">
    <h2>Totals</h2>

    <div class="pill">
      <div class="k">Total Miles</div>
      <div class="v" id="totalMiles">0.0</div>
    </div>

    <div class="pill">
      <div class="k">Mileage Claim</div>
      <div class="v" id="totalClaim">£0.00</div>
    </div>

    <div class="pill">
      <div class="k">AFR Fuel Cost</div>
      <div class="v" id="totalFuel">£0.00</div>
    </div>

    <div class="pill">
      <div class="k">VAT Element (Fuel ÷ 6)</div>
      <div class="v" id="totalVAT">£0.00</div>
    </div>

    <div class="actions">
      <button class="secondary" onclick="exportCSV()">Export CSV</button>
    </div>
  </div>

</div>

<!-- Trips Table -->
<div class="card" style="margin-top:18px;">
  <h2>Trips Logged</h2>

  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Staff</th>
        <th>Client</th>
        <th>Reason</th>
        <th>Miles</th>
        <th>Mileage £</th>
        <th>Fuel £</th>
        <th>VAT £</th>
      </tr>
    </thead>
    <tbody id="rows">
      <tr><td colspan="8" style="color:#777;">No trips added yet.</td></tr>
    </tbody>
  </table>

  <p class="note">
    AFR rates must be updated quarterly from GOV.UK advisory fuel rates guidance.
  </p>
</div>

</div>

<script>
const AFR = {
  petrol: { small:12, medium:14, large:22 },
  diesel: { small:12, medium:13, large:18 },
  lpg:    { small:11, medium:13, large:21 },
  electric_home:   { small:7, medium:7, large:7 },
  electric_public: { small:14, medium:14, large:14 }
};

const trips = [];

function gbp(n){
  return new Intl.NumberFormat("en-GB", {
    style:"currency",
    currency:"GBP"
  }).format(n);
}

function mileageClaim(miles, already){
  let threshold = 10000;
  let remaining45 = Math.max(0, threshold - already);

  let at45 = Math.min(miles, remaining45);
  let at25 = miles - at45;

  return (at45 * 0.45) + (at25 * 0.25);
}

function afrCalc(miles, fuel, engine){
  let ratePence = AFR[fuel][engine];
  let fuelCost = (ratePence/100) * miles;
  let vat = fuelCost / 6;
  return { fuelCost, vat };
}

function addTrip(){
  let date = dateInput.value;
  let staff = staffInput.value;
  let clientCode = clientCodeInput.value;
  let clientName = clientNameInput.value;
  let reason = reasonInput.value;

  let miles = parseFloat(milesInput.value);
  let already = parseFloat(alreadyInput.value) || 0;

  if(!miles || miles <= 0){
    alert("Please enter valid miles.");
    return;
  }

  let claim = mileageClaim(miles, already);
  let afr = afrCalc(miles, fuelSelect.value, engineSelect.value);

  trips.push({
    date, staff,
    client: clientCode + " – " + clientName,
    reason,
    miles,
    claim,
    fuel: afr.fuelCost,
    vat: afr.vat
  });

  render();
}

function render(){
  rows.innerHTML = "";

  let totalMiles=0, totalClaim=0, totalFuel=0, totalVAT=0;

  if(trips.length === 0){
    rows.innerHTML = `<tr><td colspan="8" style="color:#777;">No trips added yet.</td></tr>`;
  }

  trips.forEach(t=>{
    totalMiles += t.miles;
    totalClaim += t.claim;
    totalFuel += t.fuel;
    totalVAT += t.vat;

    rows.innerHTML += `
      <tr>
        <td>${t.date}</td>
        <td>${t.staff}</td>
        <td>${t.client}</td>
        <td>${t.reason}</td>
        <td>${t.miles.toFixed(1)}</td>
        <td>${gbp(t.claim)}</td>
        <td>${gbp(t.fuel)}</td>
        <td>${gbp(t.vat)}</td>
      </tr>
    `;
  });

  totalMilesEl.textContent = totalMiles.toFixed(1);
  totalClaimEl.textContent = gbp(totalClaim);
  totalFuelEl.textContent = gbp(totalFuel);
  totalVATEl.textContent = gbp(totalVAT);
}

function exportCSV(){
  let csv = "Date,Staff,Client,Reason,Miles,MileageClaim,FuelCost,VAT\n";

  trips.forEach(t=>{
    csv += `${t.date},${t.staff},${t.client},${t.reason},${t.miles.toFixed(1)},${t.claim.toFixed(2)},${t.fuel.toFixed(2)},${t.vat.toFixed(2)}\n`;
  });

  let blob = new Blob([csv], {type:"text/csv"});
  let link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "mileage_log.csv";
  link.click();
}

/* Quick DOM refs */
const dateInput = document.getElementById("date");
const staffInput = document.getElementById("staff");
const clientCodeInput = document.getElementById("clientCode");
const clientNameInput = document.getElementById("clientName");
const reasonInput = document.getElementById("reason");
const milesInput = document.getElementById("miles");
const alreadyInput = document.getElementById("already");
const fuelSelect = document.getElementById("fuel");
const engineSelect = document.getElementById("engine");

const rows = document.getElementById("rows");
const totalMilesEl = document.getElementById("totalMiles");
const totalClaimEl = document.getElementById("totalClaim");
const totalFuelEl = document.getElementById("totalFuel");
const totalVATEl = document.getElementById("totalVAT");
</script>

</body>
</html>
