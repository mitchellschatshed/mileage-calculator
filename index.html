<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mitchells Mileage Calculator</title>

<style>
  body {
    margin:0;
    background:#111;
    color:#f4f4f4;
    font-family: Arial, sans-serif;
  }

  .wrap {
    max-width: 980px;
    margin: auto;
    padding: 28px 16px 60px;
  }

  h1 {
    margin:0 0 6px;
    font-size: 22px;
  }

  p.sub {
    margin:0 0 18px;
    color:#bbb;
    font-size:14px;
    line-height:1.4;
  }

  .grid {
    display:grid;
    grid-template-columns: 1fr;
    gap:14px;
  }

  @media(min-width:860px){
    .grid {
      grid-template-columns: 1.05fr 0.95fr;
    }
  }

  .card {
    background:#1b1b1b;
    border-radius:10px;
    padding:16px;
    box-shadow:0 10px 30px rgba(0,0,0,.35);
  }

  label {
    display:block;
    font-size:13px;
    color:#bbb;
    margin:10px 0 6px;
  }

  input, select {
    width:100%;
    padding:10px 12px;
    border-radius:8px;
    border:1px solid #333;
    background:#0f0f0f;
    color:white;
  }

  button {
    background:#2aa876;
    border:none;
    color:white;
    padding:10px 14px;
    border-radius:8px;
    cursor:pointer;
    font-size:14px;
    margin-top:12px;
  }

  button.secondary {
    background:#2b2b2b;
    border:1px solid #3a3a3a;
  }

  .pill {
    background:#141414;
    border:1px solid #2a2a2a;
    padding:12px;
    border-radius:10px;
    margin-top:10px;
  }

  .pill .k {
    color:#aaa;
    font-size:12px;
  }

  .pill .v {
    font-size:18px;
    margin-top:6px;
  }

  table {
    width:100%;
    border-collapse:collapse;
    margin-top:10px;
  }

  th, td {
    border-bottom:1px solid #2a2a2a;
    padding:10px 8px;
    font-size:13px;
    text-align:left;
  }

  th {
    color:#aaa;
    font-weight:600;
  }
</style>
</head>

<body>
<div class="wrap">

<h1>Mitchells Mileage + AFR VAT Calculator</h1>
<p class="sub">
Standard mileage allowance (45p/25p) plus HMRC Advisory Fuel Rates for VAT fuel element (fuel ÷ 6).
</p>

<!-- DASHBOARD -->
<div class="grid">

  <!-- LEFT: ADD TRIP -->
  <div class="card">
    <h2 style="margin:0 0 10px;font-size:16px;">Add Trip</h2>

    <label>Date</label>
    <input id="date" type="date">

    <label>Staff Name</label>
    <input id="staff" placeholder="e.g. James Biggs">

    <label>Client Code</label>
    <input id="clientCode" placeholder="e.g. CL001">

    <label>Client Name</label>
    <input id="clientName" placeholder="e.g. ABC Limited">

    <label>Trip Reason</label>
    <input id="reason" placeholder="e.g. Client meeting, records collection">

    <label>Miles Travelled</label>
    <input id="miles" type="number" step="0.1">

    <label>Miles already claimed this tax year</label>
    <input id="already" type="number" step="1" value="0">

    <hr style="border:0;border-top:1px solid #333;margin:15px 0;">

    <h3 style="margin:0;font-size:14px;color:#ccc;">
      Advisory Fuel Rate (Company Car)
    </h3>

    <label>Fuel Type</label>
    <select id="fuel">
      <option value="petrol">Petrol</option>
      <option value="diesel">Diesel</option>
      <option value="lpg">LPG</option>
      <option value="electric_home">Electric (Home)</option>
      <option value="electric_public">Electric (Public)</option>
    </select>

    <label>Engine Size</label>
    <select id="engine">
      <option value="small">Small</option>
      <option value="medium">Medium</option>
      <option value="large">Large</option>
    </select>

    <button onclick="addTrip()">Add Trip</button>
  </div>

  <!-- RIGHT: TOTALS -->
  <div class="card">
    <h2 style="margin:0 0 10px;font-size:16px;">Totals</h2>

    <div class="pill">
      <div class="k">Total Miles</div>
      <div class="v" id="totalMiles">0.0</div>
    </div>

    <div class="pill">
      <div class="k">Mileage Claim</div>
      <div class="v" id="totalClaim">£0.00</div>
    </div>

    <div class="pill">
      <div class="k">AFR Fuel Cost</div>
      <div class="v" id="totalFuel">£0.00</div>
    </div>

    <div class="pill">
      <div class="k">VAT Element (Fuel ÷ 6)</div>
      <div class="v" id="totalVAT">£0.00</div>
    </div>

    <button class="secondary" onclick="exportCSV()">Export CSV</button>
  </div>

</div>

<!-- TRIPS TABLE -->
<div class="card" style="margin-top:14px;">
  <h2 style="margin:0 0 10px;font-size:16px;">Trips Logged</h2>

  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Staff</th>
        <th>Client Code</th>
        <th>Client Name</th>
        <th>Reason</th>
        <th>Miles</th>
        <th>Mileage £</th>
        <th>Fuel £</th>
        <th>VAT £</th>
      </tr>
    </thead>
    <tbody id="rows">
      <tr><td colspan="9" style="color:#777;">No trips added yet.</td></tr>
    </tbody>
  </table>
</div>

</div>

<script>
/* AFR Rates Table */
const AFR = {
  petrol: { small:12, medium:14, large:22 },
  diesel: { small:12, medium:13, large:18 },
  lpg:    { small:11, medium:13, large:21 },
  electric_home:   { small:7, medium:7, large:7 },
  electric_public: { small:14, medium:14, large:14 }
};

const trips = [];

function gbp(n){
  return new Intl.NumberFormat("en-GB", {
    style:"currency",
    currency:"GBP"
  }).format(n);
}

/* Standard Mileage Allowance */
function mileageClaim(miles, already){
  let threshold = 10000;
  let remaining45 = Math.max(0, threshold - already);

  let at45 = Math.min(miles, remaining45);
  let at25 = miles - at45;

  return (at45 * 0.45) + (at25 * 0.25);
}

/* AFR Fuel + VAT */
function afrCalc(miles, fuel, engine){
  let ratePence = AFR[fuel][engine];
  let fuelCost = (ratePence/100) * miles;
  let vat = fuelCost / 6;
  return { fuelCost, vat };
}

function addTrip(){
  let date = document.getElementById("date").value;
  let staff = document.getElementById("staff").value;

  let clientCode = document.getElementById("clientCode").value;
  let clientName = document.getElementById("clientName").value;
  let reason = document.getElementById("reason").value;

  let miles = parseFloat(document.getElementById("miles").value);
  let already = parseFloat(document.getElementById("already").value) || 0;

  let fuel = document.getElementById("fuel").value;
  let engine = document.getElementById("engine").value;

  if(!miles || miles<=0){
    alert("Please enter valid miles.");
    return;
  }

  let claim = mileageClaim(miles, already);
  let afr = afrCalc(miles, fuel, engine);

  trips.push({
    date, staff,
    clientCode, clientName, reason,
    miles,
    claim,
    fuel: afr.fuelCost,
    vat: afr.vat
  });

  render();
}

function render(){
  let tbody = document.getElementById("rows");
  tbody.innerHTML = "";

  let totalMiles=0, totalClaim=0, totalFuel=0, totalVAT=0;

  if(trips.length===0){
    tbody.innerHTML = `<tr><td colspan="9" style="color:#777;">No trips added yet.</td></tr>`;
  }

  trips.forEach(t=>{
    totalMiles += t.miles;
    totalClaim += t.claim;
    totalFuel += t.fuel;
    totalVAT += t.vat;

    tbody.innerHTML += `
      <tr>
        <td>${t.date}</td>
        <td>${t.staff}</td>
        <td>${t.clientCode}</td>
        <td>${t.clientName}</td>
        <td>${t.reason}</td>
        <td>${t.miles.toFixed(1)}</td>
        <td>${gbp(t.claim)}</td>
        <td>${gbp(t.fuel)}</td>
        <td>${gbp(t.vat)}</td>
      </tr>
    `;
  });

  document.getElementById("totalMiles").textContent = totalMiles.toFixed(1);
  document.getElementById("totalClaim").textContent = gbp(totalClaim);
  document.getElementById("totalFuel").textContent = gbp(totalFuel);
  document.getElementById("totalVAT").textContent = gbp(totalVAT);
}

/* Export CSV */
function exportCSV(){
  let csv = "Date,Staff,ClientCode,ClientName,Reason,Miles,MileageClaim,FuelCost,VAT\n";

  trips.forEach(t=>{
    csv += `${t.date},${t.staff},${t.clientCode},${t.clientName},${t.reason},${t.miles.toFixed(1)},${t.claim.toFixed(2)},${t.fuel.toFixed(2)},${t.vat.toFixed(2)}\n`;
  });

  let blob = new Blob([csv], {type:"text/csv"});
  let link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "mileage_log.csv";
  link.click();
}
</script>

</body>
</html>

